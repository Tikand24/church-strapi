---
import { getUrlImage } from '../lib/utils';
import type { Article } from '../types/news';

interface Props {
  article: Article;
  variant?: 'default' | 'featured';
}

const { article, variant = 'default' } = Astro.props;
const { title, description, slug, publishedAt, cover, author, category } = article;
const coverUrl = cover ? getUrlImage(cover.url) : null;
const coverAlt = cover?.alternativeText || title;
const authorName = author?.name || 'Equipo pastoral';
const categoryName = category?.name || 'General';
const articleUrl = `/noticias/${slug}`;
const publishedDate = publishedAt
  ? new Date(publishedAt).toLocaleDateString('es-CO', {
      day: 'numeric',
      month: 'long',
      year: 'numeric',
    })
  : null;

const isFeatured = variant === 'featured';
---

<article
  class={`group relative overflow-hidden rounded-2xl border border-primary/5 shadow-lg ${
    isFeatured ? 'flex min-h-[420px] items-end bg-primary/95 text-white' : 'flex flex-col h-full bg-white'
  }`}
>
  {isFeatured && coverUrl && (
    <div class="absolute inset-0 pointer-events-none">
      <img
        src={coverUrl}
        alt=""
        aria-hidden="true"
        class="h-full w-full object-cover transition-transform duration-700 group-hover:scale-105"
        loading="lazy"
      />
      <div class="absolute inset-0 bg-gradient-to-br from-black/80 via-black/40 to-primary/40" aria-hidden="true"></div>
    </div>
  )}

  {!isFeatured && coverUrl && (
    <div
      class={
        isFeatured
          ? 'relative h-72 md:h-full rounded-xl overflow-hidden'
          : 'relative h-52 w-full rounded-t-2xl overflow-hidden'
      }
    >
      <img
        src={coverUrl}
        alt={coverAlt}
        class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-[1.03]"
        loading="lazy"
      />
      <div class="absolute inset-0 bg-gradient-to-t from-black/35 via-transparent"></div>
      <div class="absolute bottom-4 left-4 flex flex-wrap items-center gap-2 text-xs font-semibold">
        <span class="rounded-full bg-white/90 px-3 py-1 text-primary">{categoryName}</span>
        {isFeatured && (
          <span class="rounded-full bg-accent-gold/90 px-3 py-1 text-white">
            Noticia destacada
          </span>
        )}
      </div>
    </div>
  )}

  <div
    class={
      isFeatured
        ? 'relative z-10 flex flex-col gap-4 p-6 md:p-10 text-white'
        : 'flex flex-1 flex-col gap-4 p-6'
    }
  >
    {isFeatured && (
      <div class="flex flex-wrap items-center gap-2 text-xs font-semibold text-white/90">
        <span class="rounded-full bg-white/20 px-3 py-1 backdrop-blur-sm">{categoryName}</span>
        <span class="rounded-full bg-accent-gold/90 px-3 py-1 text-white">Noticia destacada</span>
      </div>
    )}
    <a href={articleUrl} class="group/title block">
      <h3
        class={`font-semibold transition-colors ${
          isFeatured
            ? 'text-white group-hover/title:text-accent-gold text-3xl md:text-4xl leading-tight'
            : 'text-primary-text group-hover/title:text-primary text-2xl'
        }`}
      >
        {title}
      </h3>
    </a>
    <p class={isFeatured ? 'text-base text-white/80' : 'text-base text-primary-text/80'}>
      {description}
    </p>

    <div
      class={`flex flex-wrap items-center gap-4 text-sm ${
        isFeatured ? 'text-white/70' : 'text-primary-text/70'
      }`}
    >
      <span class={isFeatured ? 'font-semibold text-white' : 'font-semibold text-primary-text'}>{authorName}</span>
      {publishedDate && (
        <span class={isFeatured ? 'text-white/80' : 'text-primary-text/60'}>{publishedDate}</span>
      )}
    </div>

    <div class="mt-auto">
      <a
        href={articleUrl}
        class={`inline-flex items-center gap-2 text-sm font-semibold transition-all ${
          isFeatured ? 'text-white hover:gap-3 hover:text-accent-gold' : 'text-primary hover:gap-3'
        }`}
      >
        Leer m√°s
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
          <path stroke-linecap="round" stroke-linejoin="round" d="M17.25 8.25L21 12m0 0l-3.75 3.75M21 12H3" />
        </svg>
      </a>
    </div>
  </div>
</article>
